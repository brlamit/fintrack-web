{
  "swagger": "2.0",
  "info": {
    "description": "FinTrack API documentation (using Supabase JWT Bearer tokens)",
    "version": "1.0.0",
    "title": "FinTrack API"
  },
  "host": "127.0.0.1:8000",
  "basePath": "/api",
  "schemes": ["http"],
  "securityDefinitions": {
    "BearerAuth": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header",
      "description": "Use: Bearer <access_token>"
    }
  },
  "tags": [
    { "name": "Auth", "description": "Authentication endpoints" },
    { "name": "User", "description": "User profile & settings" },
    { "name": "Transactions", "description": "Transactions & statistics" },
    { "name": "Categories", "description": "Transaction categories" },
    { "name": "Receipts", "description": "Receipt upload & download" },
    { "name": "Groups", "description": "Group / Family expense split & members" },
    { "name": "Budgets", "description": "User budgets" },
    { "name": "Reports", "description": "Spending reports & export" },
    { "name": "Insights", "description": "Analytics insights" },
    { "name": "Notifications", "description": "User notifications" },
    { "name": "Sync", "description": "Sync endpoints" },
    { "name": "VoiceQR", "description": "Voice & QR parsing" },
    { "name": "Admin", "description": "Admin only endpoints" }
  ],

  "paths": {

    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "Register a new user",
        "consumes": ["multipart/form-data"],
        "parameters": [
          { "name": "name", "in": "formData", "required": true, "type": "string" },
          { "name": "email", "in": "formData", "required": true, "type": "string", "format": "email" },
          { "name": "password", "in": "formData", "required": true, "type": "string" },
          { "name": "password_confirmation", "in": "formData", "required": true, "type": "string" }
        ],
        "responses": {
          "201": { "description": "User registered" },
          "422": { "description": "Validation error" }
        }
      }
    },

    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Login user & return token",
        "consumes": ["multipart/form-data"],
        "parameters": [
          { "name": "email", "in": "formData", "required": true, "type": "string" },
          { "name": "password", "in": "formData", "required": true, "type": "string" }
        ],
        "responses": {
          "200": { "description": "Authenticated, token returned" },
          "401": { "description": "Invalid credentials" }
        }
      }
    },

    "/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "Logout user",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Logged out" },
          "401": { "description": "Unauthorized" }
        }
      }
    },

    "/auth/refresh": {
      "post": {
        "tags": ["Auth"],
        "summary": "Refresh auth token",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "New access token returned" },
          "401": { "description": "Unauthorized" }
        }
      }
    },

    "/auth/otp/verify": {
      "post": {
        "tags": ["Auth"],
        "summary": "Verify OTP",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "email", "in": "formData", "type": "string", "required": true },
          { "name": "otp", "in": "formData", "type": "string", "required": true }
        ],
        "responses": {
          "200": { "description": "OTP verified successfully" },
          "401": { "description": "Invalid or expired OTP" }
        }
      }
    },

    "/auth/otp/resend": {
      "post": {
        "tags": ["Auth"],
        "summary": "Resend OTP",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "email", "in": "formData", "type": "string", "required": true }
        ],
        "responses": {
          "200": { "description": "OTP resent successfully" }
        }
      }
    },

    "/auth/2fa/disable": {
      "post": {
        "tags": ["Auth"],
        "summary": "Disable 2FA",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "2FA disabled" }
        }
      }
    },

    "/auth/2fa/enable": {
      "get": {
        "tags": ["Auth"],
        "summary": "Enable 2FA",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "2FA enabled" }
        }
      }
    },

    "/me/profile": {
      "get": {
        "tags": ["User"],
        "summary": "Get current user profile",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "User profile returned" }
        }
      }
    },

    "/security": {
      "get": {
        "tags": ["User"],
        "summary": "Get security settings",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Security settings returned" }
        }
      }
    },

    "/preferences": {
      "get": {
        "tags": ["User"],
        "summary": "Get preferences",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Preferences returned" }
        }
      },
      "put": {
        "tags": ["User"],
        "summary": "Update preferences",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "language", "in": "formData", "type": "string" },
          { "name": "currency", "in": "formData", "type": "string" }
        ],
        "responses": {
          "200": { "description": "Preferences updated" }
        }
      }
    },

    "/profile/avatar": {
      "post": {
        "tags": ["User"],
        "summary": "Upload avatar",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "avatar", "in": "formData", "type": "file", "required": true }
        ],
        "responses": {
          "200": { "description": "Avatar uploaded" }
        }
      }
    },

    "/profile/avatar/remove": {
      "post": {
        "tags": ["User"],
        "summary": "Remove avatar",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Avatar removed" }
        }
      }
    },

    "/transactions/statistics": {
      "get": {
        "tags": ["Transactions"],
        "summary": "Get statistics",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Statistics" }
        }
      }
    },

    "/transactions": {
      "get": {
        "tags": ["Transactions"],
        "summary": "List all transactions",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "List" } }
      },
      "post": {
        "tags": ["Transactions"],
        "summary": "Create transaction",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "amount", "in": "formData", "type": "number", "required": true },
          { "name": "type", "in": "formData", "type": "string", "enum": ["income", "expense"], "required": true },
          { "name": "transaction_date", "in": "formData", "type": "string", "format": "date", "required": true },
          { "name": "category_id", "in": "formData", "type": "integer" },
          { "name": "notes", "in": "formData", "type": "string" }
        ],
        "responses": {
          "201": { "description": "Created" }
        }
      }
    },

    "/transactions/{transaction}": {
      "parameters": [
        { "name": "transaction", "in": "path", "type": "integer", "required": true }
      ],
      "get": {
        "tags": ["Transactions"],
        "summary": "Get transaction",
        "security": [{ "BearerAuth": [] }],
        "responses": {
          "200": { "description": "Transaction" }
        }
      },
      "put": {
        "tags": ["Transactions"],
        "summary": "Update transaction",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "amount", "in": "formData", "type": "number" }
        ],
        "responses": {
          "200": { "description": "Updated" }
        }
      },
      "delete": {
        "tags": ["Transactions"],
        "summary": "Delete transaction",
        "security": [{ "BearerAuth": [] }],
        "responses": { "204": { "description": "Deleted" } }
      }
    },

    "/categories": {
      "get": {
        "tags": ["Categories"],
        "summary": "List categories",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Categories list" } }
      },
      "post": {
        "tags": ["Categories"],
        "summary": "Create category",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "name", "in": "formData", "type": "string", "required": true }
        ],
        "responses": { "201": { "description": "Created" } }
      }
    },

    "/categories/{category}": {
      "parameters": [
        { "name": "category", "in": "path", "type": "integer", "required": true }
      ],
      "get": {
        "tags": ["Categories"],
        "summary": "Get category",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Category" } }
      },
      "put": {
        "tags": ["Categories"],
        "summary": "Update category",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "name", "in": "formData", "type": "string" }
        ],
        "responses": { "200": { "description": "Updated" } }
      },
      "delete": {
        "tags": ["Categories"],
        "summary": "Delete category",
        "security": [{ "BearerAuth": [] }],
        "responses": { "204": { "description": "Deleted" } }
      }
    },

    "/receipts": {
      "get": {
        "tags": ["Receipts"],
        "summary": "List receipts",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Receipts list" } }
      },
      "post": {
        "tags": ["Receipts"],
        "summary": "Upload receipt",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "file", "in": "formData", "type": "file", "required": true }
        ],
        "responses": { "201": { "description": "Uploaded" } }
      }
    },

    "/receipts/{receipt}/download": {
      "parameters": [
        { "name": "receipt", "in": "path", "type": "integer", "required": true }
      ],
      "get": {
        "tags": ["Receipts"],
        "summary": "Download receipt",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "File stream" } }
      }
    },

    "/groups": {
      "get": {
        "tags": ["Groups"],
        "summary": "List all groups",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Groups list" } }
      },
      "post": {
        "tags": ["Groups"],
        "summary": "Create group",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "name", "in": "formData", "type": "string", "required": true },
          { "name": "description", "in": "formData", "type": "string" },
          { "name": "type", "in": "formData", "type": "string", "enum": ["family", "friends", "work"], "required": true }
        ],
        "responses": { "201": { "description": "Group created" } }
      }
    },

    "/groups/{group}": {
      "parameters": [
        { "name": "group", "in": "path", "type": "integer", "required": true }
      ],
      "get": {
        "tags": ["Groups"],
        "summary": "Get group",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Group details" } }
      },
      "delete": {
        "tags": ["Groups"],
        "summary": "Delete group",
        "security": [{ "BearerAuth": [] }],
        "responses": { "204": { "description": "Deleted" } }
      }
    },

    "/groups/{group}/members": {
      "parameters": [
        { "name": "group", "in": "path", "type": "integer", "required": true }
      ],
      "get": {
        "tags": ["Groups"],
        "summary": "List group members",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Members list" } }
      }
    },

    "/groups/{group}/invite": {
      "parameters": [
        { "name": "group", "in": "path", "type": "integer", "required": true }
      ],
      "post": {
        "tags": ["Groups"],
        "summary": "Invite member",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "name", "in": "formData", "type": "string", "required": true },
          { "name": "email", "in": "formData", "type": "string", "required": true }

        ],
        "responses": { "200": { "description": "Invited" } }
      }
    },

    "/groups/{group}/members/{member}": {
      "parameters": [
        { "name": "group", "in": "path", "type": "integer", "required": true },
        { "name": "member", "in": "path", "type": "string", "required": true }
      ],
      "delete": {
        "tags": ["Groups"],
        "summary": "Remove member",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Member removed" } }
      }
    },

    "/groups/{group}/split": {
      "parameters": [
        { "name": "group", "in": "path", "type": "integer", "required": true }
      ],
      "post": {
        "tags": ["Groups"],
        "summary": "Split group expense",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Expense split" } }
      }
    },

    "/auth/updatePassword/send-otp": {
      "post": {
        "tags": ["Auth"],
        "summary": "Send OTP for password update",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "email", "in": "formData", "type": "string", "required": true }
        ],
        "responses": { "200": { "description": "OTP sent" } }
      }
    },

    "/budgets": {
      "get": {
        "tags": ["Budgets"],
        "summary": "List budgets",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Budgets list" } }
      },
      "post": {
        "tags": ["Budgets"],
        "summary": "Create budget",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "name", "in":"formData", "type": "string", "required":true},
          { "name": "amount", "in": "formData", "type": "number", "required": true },
          { "name": "start_date", "in": "formData", "type": "string", "format": "date", "required": true },
          { "name": "end_date", "in": "formData", "type": "string", "format": "date", "required": true },
          { "name": "period", "in": "formData", "type": "string", "enum": ["weekly","monthly", "yearly"], "required": true }
        ],
        "responses": { "201": { "description": "Created" } }
      }
    },

    "/reports/spending": {
      "get": {
        "tags": ["Reports"],
        "summary": "Spending report",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Report data" } }
      }
    },

    "/reports/{report}/export": {
      "parameters": [
        {"name": "report", "in": "path", "type": "string", "required": true },
        { "name": "format", "in": "query", "type": "string", "enum": ["pdf", "csv"], "required": true },
        { "name": "type", "in": "query", "type": "string", "enum": ["all", "income", "expense"], "required": false }
      ],
      "get": {
        "tags": ["Reports"],
        "summary": "Export spending report",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Exported file" } }
      }
    },

    "/insights": {
      "get": {
        "tags": ["Insights"],
        "summary": "Get insights",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Insights data" } }
      }
    },

    "/notifications": {
      "get": {
        "tags": ["Notifications"],
        "summary": "List notifications",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Notifications list" } }
      }
    },

    "/notifications/unread-count": {
      "get": {
        "tags": ["Notifications"],
        "summary": "Get unread count",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Count returned" } }
      }
    },

    "/notifications/{notification}/mark-read": {
      "parameters": [
        { "name": "notification", "in": "path", "type": "string", "required": true }
      ],
      "post": {
        "tags": ["Notifications"],
        "summary": "Mark notification read",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Marked read" } }
      }
    },

    "/notifications/mark-all-read": {
      "post": {
        "tags": ["Notifications"],
        "summary": "Mark all as read",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "All marked read" } }
      }
    },

    "/sync/transactions": {
      "post": {
        "tags": ["Sync"],
        "summary": "Sync transactions",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Sync success" } }
      }
    },

    "/voice/parse": {
      "post": {
        "tags": ["VoiceQR"],
        "summary": "Parse voice input",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "audio", "in": "formData", "type": "file", "required": true }
        ],
        "responses": { "200": { "description": "Voice parsed" } }
      }
    },

    "/qr/parse": {
      "post": {
        "tags": ["VoiceQR"],
        "summary": "Parse QR input",
        "consumes": ["multipart/form-data"],
        "security": [{ "BearerAuth": [] }],
        "parameters": [
          { "name": "image", "in": "formData", "type": "file", "required": true }
        ],
        "responses": { "200": { "description": "QR parsed" } }
      }
    },

    "/admin/users": {
      "get": {
        "tags": ["Admin"],
        "summary": "Admin: List users",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Users list" } }
      }
    },

    "/admin/transactions": {
      "get": {
        "tags": ["Admin"],
        "summary": "Admin: List transactions",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Transactions list" } }
      }
    },

    "/admin/impersonate/{user}": {
      "parameters": [
        { "name": "user", "in": "path", "type": "integer", "required": true }
      ],
      "post": {
        "tags": ["Admin"],
        "summary": "Admin: Impersonate user",
        "security": [{ "BearerAuth": [] }],
        "responses": { "200": { "description": "Impersonation started" } }
      }
    }
  }
}
